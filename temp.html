<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />
    <meta name="viewport" content="height=device-height,initial-scale=1,shrink-to-fit=no" />
    <link rel="icon" href="https://cdn3.iconfinder.com/data/icons/movies-4/48/pokemon-movie-cinema-ball-512.png">
    <link rel='stylesheet' href="style.css" />
    <title>SQA Dashboard</title>
    <script>
        const TEXTAREA_WIDTH = 40

        function createElement(element, attribute, inner) {
            if (typeof (element) === "undefined") {
                return false;
            }
            if (typeof (inner) === "undefined") {
                inner = "";
            }
            var el = document.createElement(element);
            if (typeof (attribute) === 'object') {
                for (var key in attribute) {
                    el.setAttribute(key, attribute[key]);
                }
            }

            if (!Array.isArray(inner)) {
                inner = [inner];
            }

            for (var k = 0; k < inner.length; k++) {
                if (inner[k].tagName) {
                    el.appendChild(inner[k]);
                } else {
                    el.appendChild(document.createTextNode(inner[k]));
                }
            }
            return el;
        }

        class CollectionContainer {
            constructor(json_colls = [{ 'New Collection': [] }], main_HTML_ID = 'collections', edit_button_ID = 'edit-button') {
                CollectionContainer.editMode = false;
                this.body = []
                this.HTML = document.getElementById(main_HTML_ID)
                this.editButton = document.getElementById(edit_button_ID)
                let coll;
                for (let i in json_colls) {
                    let coll = new Collection(json_colls[i])
                    this.body.push(coll)
                    this.HTML.appendChild(coll.HTML.main)
                }

                this.editButton.onclick = () => { this.toggleEditMode() }
            }

            toggleEditMode() {
                let temp;
                for (let col in this.body) {
                    for (let cont in this.body[col].body) {
                        for (let item in this.body[col].body[cont].body) { 
                            temp = this.body[col].body[cont].body[item]
                            if (!CollectionContainer.editMode || temp.body.length == 0)
                                temp.HTML.head['expand-button'].hidden = CollectionContainer.editMode
                            
                            
                            temp.HTML.head.title.readOnly = CollectionContainer.editMode
                            temp.HTML.head.title.disabled = CollectionContainer.editMode
                            temp.HTML.head['delete-button'].hidden = CollectionContainer.editMode
                            
                            if (CollectionContainer.editMode && temp.expanded)
                                temp.toggleExpand()
                        }
                    }
                }

                CollectionContainer.editMode = !CollectionContainer.editMode
            }
        }
        CollectionContainer.editMode = false;

        class Collection {
            constructor(json_coll = { 'New Collection': [] }) {
                this.title = Object.keys(json_coll)[0];
                json_coll = json_coll[this.title]
                this.body = []
                this.HTML = {}
                this.HTML.main = createElement('div', { class: 'collection' })
                this.HTML.head = {}
                this.HTML.head.main = createElement('div', { class: 'collection-head' })
                this.HTML.head.title = createElement('input', { class: 'collection-title', value: this.title, readonly: true },)
                this.HTML.head['delete-button'] = createElement('button', { class: 'little-button delete-button', hidden: true })

                for (let name in this.HTML.head)
                    if (name != 'main')
                        this.HTML.head.main.appendChild(this.HTML.head[name])

                this.HTML.main.appendChild(this.HTML.head.main)

                this.HTML.body = createElement('div', { class: 'collection-body' })
                this.HTML.main.appendChild(this.HTML.body)

                let json_cont;
                for (let i in json_coll) {
                    json_cont = json_coll[i]
                    this.add(json_cont)
                }
            }

            add(json_cont) {
                let cont = new Container(json_cont)
                this.body.push(cont)
                this.HTML.body.appendChild(cont.HTML.main)
            }

        }

        class Container {
            constructor(json_cont = { 'New Container': '' }) {
                this.title = Object.keys(json_cont)[0]
                json_cont = json_cont[this.title]
                this.body = []
                this.HTML = {}
                this.HTML.main = createElement('div', { class: 'container' })
                this.HTML.head = {}
                this.HTML.head.main = createElement('div', { class: 'container-head' })

                this.HTML.head['delete-button'] = createElement('button', { class: 'little-button delete-button', hidden: true })
                this.HTML.head.title = createElement('input', { class: 'container-title', value: this.title, readonly: true },)

                for (let name in this.HTML.head)
                    if (name != 'main')
                        this.HTML.head.main.appendChild(this.HTML.head[name])

                this.HTML.main.appendChild(this.HTML.head.main)

                this.HTML.body = createElement('ul', { class: 'container-body' })
                this.HTML.main.appendChild(this.HTML.body)

                let json_item;
                for (let i in json_cont) {
                    json_item = json_cont[i]
                    this.add(json_item)
                }
            }

            add(json_item = { 'New Item': ['Empty URL'] }) {
                let item = new Item(json_item)
                this.body.push(item)
                this.HTML.body.appendChild(item.HTML.main)
            }
        }

        class Item {
            constructor(json_item = { 'New Item': ['Empty URL'] }, depth = 0, expanded = false) {
                this.title = Object.keys(json_item)[0]
                json_item = json_item[this.title]
                this.depth = depth
                this.expanded = expanded;
                if (this.title.startsWith('*')) {
                    this.immutable = true
                    this.title = this.title.substr(1)
                } else this.immutable = false;
                if (!(json_item instanceof Array))
                    json_item = [json_item]
                this.url =  (json_item[0] instanceof String)? json_item[0]:''
                this.body = []

                this.HTML = {}
                this.HTML.main = createElement('li', { class: 'item' })

                this.HTML.head = {
                    main: createElement('div', { class: 'item-head' }),
                    'delete-button': createElement('button', { class: 'little-button delete-button', hidden: true }),
                    title: createElement('input', { class: `item-title ${(this.url != '') ? 'clickable' : ''}`, value: this.title, readonly: true },),
                    'expand-button': createElement('button', { class: 'little-button expand-button', hidden: true })
                }
                this.HTML.head['expand-button'].onclick = () => { this.toggleExpand() }
                this.HTML.head.title.onclick = () => { this.titleClicked() }

                for (let name in this.HTML.head)
                    if (name != 'main')
                        this.HTML.head.main.appendChild(this.HTML.head[name])
                this.HTML.main.appendChild(this.HTML.head.main)

                this.HTML.body = {
                    main: createElement('ul', { class: 'item-body', hidden: true }),
                    url: createElement('input', { class: 'item-url', value: this.url, readonly: true, hidden: true },)
                }
                this.HTML.body.main.appendChild(createElement('li', { class: 'item-content' }, this.HTML.body.url))
                this.HTML.main.appendChild(this.HTML.body.main)

                let item;
                for (let i in json_item) {
                    if (json_item[i] instanceof Object) {
                        this.HTML.head['expand-button'].hidden = false
                        this.add(json_item[i])
                    }
                }
            }

            add(json_item = { 'New Item': ['Empty URL'] }) {
                var item = new Item(json_item, this.depth + 1)
                this.body.push(item)
                this.HTML.body.main.appendChild(item.HTML.main)
            }

            toggleExpand() {
                this.HTML.body.main.hidden = this.expanded
                this.HTML.body.url.hidden = !CollectionContainer.editMode
                this.expanded = !this.expanded
            }

            static webFileTypesRegEx = '(https://|https:\\\\|https://|http:\\\\).*|.*(\.pdf)'
            titleClicked() {
                let dir = this.url
                if (CollectionContainer.editMode && this.url != '') {
                    if (this.url.match(Item.webFileTypesRegEx)) {
                        window.open(this.url, '_blank')
                    } else {
                        navigator.clipboard.writeText(this.url).then(function () {
                            alert(`${dir} was copied to your clipboard.\nTo open press Winkey+R, Winkey+V, Enter `)
                        }, function () {
                            alert('ERROR\nPlease try again')
                        })
                    }
                }
            }
        }

        var reg = /(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g
        var bookmarks = [{ 'Main Collection': [{ '🌐Search Engines': [{ '*🔎Google': 'https://www.google.com' }, { '🧷Bing': 'https://www.Bing.com' }] }, { '📢 Social Media': [{ '💠Facebook': ['https://www.facebook.com', { "All of Facebook's apps": '' }, { '📸Instegram': 'https://www.instegram.com' }, { '✔️Whatsapp': 'https://web.whatsapp.com' }] }, { '🌀Twitter': 'https://www.twitter.com' }, { '🔻Youtube': 'https://www.youtube.com' }] }, { '📰News Sites': [{ 'Popular News Sites': '' }, { '🦊 FOX': 'https://www.foxnews.com' }, { '☕️ BBC': 'https://www.bbc.com/news' }, { '🏈 ESPN': 'https://www.espn.com/' }] }] }, { 'Created By': [{ 'Yair Charit': [{ '👨🏽\u200d💻 See some more of my work 👨🏽\u200d💻': '' }, { '*👓Portfolio': 'https://yaircharit.github.io' }, { '*💼LinkedIn': 'https://il.linkedin.com/in/yair-charit' }, { '*👷🏽\u200d♂️ Github': 'https://github.com/yaircharit' }, { '*CV': 'Yair Charit - CV2021.pdf' }] }] }]
        // %INJECT BOOKMARKS HERE%
        // document.staticMarks will be inserted above. the line below is only for testing purposes
        // %INJECT NEWSFEED HERE%
    </script>
</head>

<body>

    <div id="collections"></div>
    <footer>
        <div style="float:right; flex-direction: column; ">
            <button id='edit-button' class="intButton editButton">Edit</button>
            <button id="download-button" class="intButton saveButton" onclick="">Download</button></a>
        </div>
        <div style="float:right; bottom: 0; flex-direction: column; display: flex; padding: 1em;  ">
            <p style="margin: 0%;">Made by Yair Charit</p>
            <a href="https://github.com/yaircharit/Dashboard-Plus">Git Repository</a>
        </div>
    </footer>
    <script>
        let cc = new CollectionContainer(bookmarks, 'collections')
    </script>


</body>

</html>