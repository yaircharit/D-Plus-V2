<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />
    <meta name="viewport" content="height=device-height,initial-scale=1,shrink-to-fit=no" />
    <link rel="icon" href="https://cdn3.iconfinder.com/data/icons/movies-4/48/pokemon-movie-cinema-ball-512.png">
    <title>SQA Dashboard</title>
    <style>
        input {
            border: none;
            background-color: transparent;
        }

        ul {
            padding-left: 20px;
            padding-bottom: 10px;
        }

        ul.container-body>li.item,
        li.item-content {
            list-style-type: none;
        }

        .clickable {
            color: #455b97;
        }

        button {
            border-radius: 50px;
        }

        .little-button {
            width: 1em;
            height: 1em;
            margin: 0%;
            border: none;
        }

        .delete-button {
            background-color: maroon;
            color: lightgray;
            text-align: center;
        }

        .add-button {
            background-color: rgb(131, 180, 131);
            color: lightgray;
            text-align: center;
        }

        button.expand-button {
            background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMjAgNTEyIj48cGF0aCBkPSJNMTUxLjUgMzQ3LjhMMy41IDIwMWMtNC43LTQuNy00LjctMTIuMyAwLTE3bDE5LjgtMTkuOGM0LjctNC43IDEyLjMtNC43IDE3IDBMMTYwIDI4Mi43bDExOS43LTExOC41YzQuNy00LjcgMTIuMy00LjcgMTcgMGwxOS44IDE5LjhjNC43IDQuNyA0LjcgMTIuMyAwIDE3bC0xNDggMTQ2LjhjLTQuNyA0LjctMTIuMyA0LjctMTcgMHoiLz48L3N2Zz4=);
            background-repeat: no-repeat;
            background-color: transparent;
        }

        .collection {
            display: inline-flex;
            flex-direction: column;
            flex-wrap: wrap;
            /* background-color: goldenrod; */
            padding: 2em;
        }

        .collection-title {
            border: none;
            font-size: 2em;
        }

        .container {
            margin: 1em;
            width: fit-content;
            font-size: 0.3em;
            /* border-radius: 25px; */
        }

        .container-head {
            background-color: rgb(112, 112, 112);
            padding: 0.5em;
            border-bottom: rgb(97, 97, 97) 2px solid;
            border-radius: 10px 10px 0 0;
            color: white;
            /* width: max-content; */
        }

        .container-body {
            background-color: lightgray;
            border-radius: 0 0 10px 10px;
            margin: 0;
            padding: 1em;
            /* width: max-content; */
        }
    </style>
    <script>
        const TEXTAREA_WIDTH = 40

        var reg = /(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/g
        var bookmarks = [{ 'Main Collection': [{ 'üåêSearch Engines': [{ '*üîéGoogle': 'https://www.google.com' }, { 'üß∑Bing': 'https://www.Bing.com' }] }, { 'üì¢ Social Media': [{ 'üí†Facebook': ['https://www.facebook.com', { "All of Facebook's apps": '' }, { 'üì∏Instegram': 'https://www.instegram.com' }, { '‚úîÔ∏èWhatsapp': 'https://web.whatsapp.com' }] }, { 'üåÄTwitter': 'https://www.twitter.com' }, { 'üîªYoutube': 'https://www.youtube.com' }] }, { 'üì∞News Sites': [{ 'Popular News Sites': '' }, { 'ü¶ä FOX': 'https://www.foxnews.com' }, { '‚òïÔ∏è BBC': 'https://www.bbc.com/news' }, { 'üèà ESPN': 'https://www.espn.com/' }] }] }, { 'Created By': [{ 'Yair Charit': [{ 'üë®üèΩ\u200düíª See some more of my work üë®üèΩ\u200düíª': '' }, { '*üëìPortfolio': 'https://yaircharit.github.io' }, { '*üíºLinkedIn': 'https://il.linkedin.com/in/yair-charit' }, { '*üë∑üèΩ\u200d‚ôÇÔ∏è Github': 'https://github.com/yaircharit' }, { '*CV': 'Yair Charit - CV2021.pdf' }] }] }]
        // %INJECT BOOKMARKS HERE%
        // %INJECT NEWSFEED HERE%

        var e = 'keyup,keypress,focus,blur,change'.split(',');
        function createElement(element, attribute, inner) {
            if (typeof (element) === "undefined") {
                return false;
            }
            if (typeof (inner) === "undefined") {
                inner = "";
            }
            var el = document.createElement(element);
            if (typeof (attribute) === 'object') {
                for (var key in attribute) {
                    el.setAttribute(key, attribute[key]);
                }
            }

            if (!Array.isArray(inner)) {
                inner = [inner];
            }

            for (var k = 0; k < inner.length; k++) {
                if (inner[k].tagName) {
                    el.appendChild(inner[k]);
                } else {
                    el.appendChild(document.createTextNode(inner[k]));
                }
            }
            if (element == 'input') {
                addResizeFunc(el)
            }
            return el;
        }

        function addResizeFunc(input_element) {
            function fitSize() {
                input_element.style.width = `${((input_element.value.length - [...input_element.value.matchAll(reg)].length) * 10)}px`
            }
            fitSize(input_element)
            for (var i in e) input_element.addEventListener(e[i], fitSize, false);
        }

        function add(obj, json_obj = undefined) {
            let func = ((obj instanceof CollectionContainer) ? ((obj, json) => { return new Collection(obj, json) }) : ((obj instanceof Collection) ? (obj, json) => { return new Container(obj, json) } : (obj, json) => { return new Item(obj, json) }))
            let temp = (json_obj != undefined) ? func(obj, json_obj) : func(obj)
            obj.body.push(temp)
            obj.HTML.body.main.appendChild(temp.HTML.main)
        }

        function remove(obj) {
            obj.parent.body = obj.parent.body.filter((el) => { return el != obj })
            obj.parent.HTML.body.main.removeChild(obj.HTML.main)
            delete obj
        }
        function generateAddButton(obj) {
            obj.HTML.body.addButton = createElement('button', { class: 'little-button add-button', hidden: true }, '+')
            obj.HTML.body.addButton.onclick = () => {
                obj.HTML.body.main.removeChild(obj.HTML.body.center)
                add(obj)
                obj.HTML.body.main.appendChild(obj.HTML.body.center)
            }
            obj.HTML.body.addButton.hidden = !CollectionContainer.editMode
            obj.HTML.body.center = createElement('center', {}, obj.HTML.body.addButton)
            obj.HTML.body.main.appendChild(obj.HTML.body.center)
        }

        function generateHead(obj) {
            obj.HTML.head = {}
            let obj_type = obj.constructor.name.toLowerCase()
            obj.HTML.head.main = createElement('div', { class: obj_type + '-head' })

            obj.HTML.head.deleteButton = createElement('button', { class: 'little-button delete-button', hidden: true })
            obj.HTML.head.deleteButton.onclick = () => { remove(obj) }
            obj.HTML.head.deleteButton.hidden = !CollectionContainer.editMode;

            obj.HTML.head.title = createElement('input', { class: obj_type + '-title', value: obj.title, readonly: true },)
            obj.HTML.head.title.readOnly = !CollectionContainer.editMode;

            if (obj_type == 'item') {
                obj.HTML.head.expandButton = createElement('button', { class: 'little-button expand-button' })
                obj.HTML.head.expandButton.hidden = !CollectionContainer.editMode && obj.body.length == 0;
                obj.HTML.head.expandButton.onclick = () => { obj.toggleExpand() }
                obj.HTML.head.title.onclick = () => { obj.titleClicked(); }
            }

            for (let name in obj.HTML.head)
                if (name != 'main')
                    obj.HTML.head.main.appendChild(obj.HTML.head[name])
        }

        function generateBody(obj, json_obj) {
            obj.HTML.body = {}
            obj.body = []
            let obj_type = obj.constructor.name.toLowerCase()
            let elem_type = (obj_type == 'collection') ? 'div' : 'ul'

            obj.HTML.body.main = createElement(elem_type, { class: obj_type + '-body' })
            if (obj_type == 'item') {
                obj.url = Object.values(json_obj)[0]
                if (obj.url instanceof Array)
                    obj.url = obj.url[0]
                console.log(obj.url)
                obj.HTML.body.url = createElement('input', { class: 'item-url', value: obj.url, readonly: true, hidden: true },)
                obj.HTML.body.main.hidden = true
                obj.HTML.body.main.appendChild(createElement('li', { class: 'item-content' }, obj.HTML.body.url))
            }
            json_obj = json_obj[obj.title]
            for (let i in json_obj) {
                if (json_obj[i] instanceof Object) {
                    add(obj, json_obj[i])
                }
            }
            generateAddButton(obj)
        }

        function generateHTML(obj, json) {
            obj.HTML = {}
            let obj_type = obj.constructor.name.toLowerCase()
            let elem_type = (obj_type == 'item') ? 'li' : 'div'
            obj.title = Object.keys(json)[0]
            if (obj.title.startsWith('*')) {
                obj.immutable = true
                obj.title = obj.title.substr(1)
            } else obj.immutable = false;

            obj.HTML.main = createElement(elem_type, { class: obj_type })

            generateBody(obj, json)
            generateHead(obj)

            obj.HTML.main.appendChild(obj.HTML.head.main)
            obj.HTML.main.appendChild(obj.HTML.body.main)
        }

        function toggleEditMode(obj) {
            obj.HTML.head.deleteButton.hidden = CollectionContainer.editMode
            obj.HTML.head.title.readOnly = CollectionContainer.editMode
            obj.HTML.body.addButton.hidden = CollectionContainer.editMode
            if (CollectionContainer.editMode)
                obj.title = obj.HTML.head.title.value
            
            if (obj.constructor.name == 'Item') {
                obj.HTML.head.expandButton.hidden = CollectionContainer.editMode
                if (CollectionContainer.editMode)
                    obj.url = obj.HTML.body.url.value
                obj.HTML.body.url.hidden = CollectionContainer.editMode
                obj.HTML.body.url.readOnly = CollectionContainer.editMode
            }

            for (let i in obj.body) { toggleEditMode(obj.body[i]) }
        }

        class CollectionContainer {
            constructor(json_colls = [{ 'New Collection': [] }], main_HTML_ID = 'collections', edit_button_ID = 'edit-button') {
                CollectionContainer.editMode = false;
                this.body = []
                this.HTML = {body: {}}
                this.HTML.body.main = document.getElementById(main_HTML_ID)
                this.HTML.editButton = document.getElementById(edit_button_ID)

                for (let i in json_colls) {
                    add(this, json_colls[i])
                }

                this.HTML.editButton.onclick = () => { this.toggleEditMode() }
                generateAddButton(this)
            }

            toggleEditMode() {
                for (let col in this.body) { toggleEditMode(this.body[col]); }
                this.HTML.editButton.innerHTML = (this.HTML.editButton.innerHTML == 'Edit') ? 'Save' : 'Edit';
                if (CollectionContainer.editMode) { bookmarks = this.JSON }
                CollectionContainer.editMode = !CollectionContainer.editMode
            }

            download() {
                let fullHTML = document.documentElement.innerHTML
                let head = fullHTML.substr(0, fullHTML.search('<bo' + 'dy>'))
                head = head.replace(/\s*var bookmarks = \[.*\n/g, '\n\t\tvar ' + `bookmarks = ${JSON.stringify(this.JSON)}\n`)
                console.log(head)
                let body = '<bo' + 'dy><div id="collections"></div>'
                let footer = fullHTML.substr(fullHTML.search('<foo' + 'ter>')) + ''
                let res = `<!DOCTYPE html><html lang="en">${head}${body}${footer}</html>`

                var element = document.createElement('a');
                element.setAttribute('href', `data:text/html;charset=utf-8,${encodeURIComponent(res)}`);
                element.setAttribute('download', 'SQADashboard.html');
                element.click();
            }

            get JSON() {
                let temp = []
                for (let i in this.body) temp.push(this.body[i].JSON)
                return temp;
            }
        }
        CollectionContainer.editMode = false;

        class Collection {
            constructor(parent, json_coll = { 'New Collection': [] }) {
                this.parent = parent
                generateHTML(this, json_coll)
            }

            get JSON() {
                let temp = {}
                temp[`${this.title}`] = []
                for (let i in this.body) temp[`${this.title}`].push(this.body[i].JSON)
                return temp;
            }
        }

        class Container {
            constructor(parent, json_cont = { 'New Container': '' }) {
                this.parent = parent
                generateHTML(this, json_cont)
            }

            get JSON() {
                let temp = {}
                temp[`${this.title}`] = []
                for (let i in this.body) temp[`${this.title}`].push(this.body[i].JSON)
                return temp;
            }
        }

        class Item {
            constructor(parent, json_item = { 'New Item': ['Empty URL'] }) {
                this.parent = parent;
                this.expanded = false;
                generateHTML(this, json_item)
            }

            toggleExpand() {
                this.HTML.body.main.hidden = this.expanded
                this.expanded = !this.expanded
                this.HTML.body.addButton.hidden = !(this.expanded && CollectionContainer.editMode)
            }

            static webFileTypesRegEx = '(https://|https:\\\\|https://|http:\\\\).*|.*(\.pdf)'
            titleClicked() {
                let dir = this.url
                if (!CollectionContainer.editMode && this.url != '') {
                    console.log(this)
                    if (this.url.match(Item.webFileTypesRegEx)) {
                        window.open(this.url, '_blank')
                    } else {
                        navigator.clipboard.writeText(this.url).then(function () {
                            alert(`${dir} was copied to your clipboard.\nTo open press Winkey+R, Winkey+V, Enter `)
                        }, function () {
                            alert('ERROR\nPlease try again')
                        })
                    }
                }
            }

            get JSON() {
                let temp = {}
                temp[`${this.title}`] = [this.url]
                for (let i in this.body) temp[`${this.title}`].push(this.body[i].JSON)
                return temp;
            }
        }

    </script>
</head>

<body>
    <div id="collections"></div>
    <footer>
        <div style="float:right; flex-direction: column; ">
            <button id='edit-button' class="intButton editButton">Edit</button>
            <button id="download-button" class="intButton saveButton" onclick="cc.download()">Download</button></a>
        </div>
    </footer>
    <script>
        let cc = new CollectionContainer(bookmarks, 'collections')
    </script>
</body>

</html>